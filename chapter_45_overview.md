# **第45章. Application插件**

Chapter 45. The Application Plugin

Application插件让创建可执行的JVM应用更方便.在软件开发期间,很容易启动本地的应用,并按照tar或者zip格式打包应用,包括操作系统指定的启动脚本。

The Application plugin facilitates creating an executable JVM application. It makes it easy to start the application locally during development, and to packaging the application as a TAR and/or ZIP including operating system specific start scripts.

应用application插件也需隐含的应用Java插件.你的source设置对于application来说也是有效的.

Applying the Application plugin also implicitly applies the Java plugin. The main source set is effectively the “application”.

应用application插件也需隐含的应用Distribution插件.一个主distribution被创建后会打包应用,包括代码依赖关系和生成启动脚本.

Applying the Application plugin also implicitly applies the Distribution plugin. A main distribution is created that packages up the application, including code dependencies and generated start scripts.

## **45.1.用法**

45.1. Usage

要使用application插件，需首先在你的构建脚本中引用它.

To use the application plugin, include the following in your build script:

示例45.1.使用application插件

Example 45.1. Using the application plugin

build.gradle
```
  apply plugin: 'application'
```

该插件需指定应用的main class(主类/程序入口)是必不可少配置。

The only mandatory configuration for the plugin is the specification of the main class (i.e. entry point) of the application.

示例45.2. 配置应用程序的main class

Example 45.2. Configure the application main class

build.gradle
```
    mainClassName = "org.gradle.sample.Main"
```

你可以通过执行run task(类型：JavaExec)来运行应用程序.这将会编译主要源集合并启动一个新的JVM及及其类(所有运行时的依赖)的classpath，并使用指定的主类。你可以利用gradle run --debug-jvm (参见JavaExec.setDebug())来启动应用程序的debug模式。

You can run the application by executing the run task (type: JavaExec). This will compile the main source set, and launch a new JVM with its classes (along with all runtime dependencies) as the classpath and using the specified main class. You can launch the application in debug mode with gradle run --debug-jvm (see JavaExec.setDebug()).

如果你的应用需要一组指定JVM的设置或系统属性,你可以配置applicationDefaultJvmArgs属性,这些JVM参数会被应用到run task中,也会把它当作distribution生成的启动脚本的一部分。

If your application requires a specific set of JVM settings or system properties, you can configure the applicationDefaultJvmArgs property. These JVM arguments are applied to the run task and also considered in the generated start scripts of your distribution.

示例 45.3. 配置默认JVM设置
Example 45.3. Configure default JVM settings

build.gradle
```
    applicationDefaultJvmArgs = ["-Dgreeting.language=en"]
```

45.1.1. The distribution

通过Distribution插件可以创建应用程序的分布，一个主要的通过distribution会创建以下内容：

A distribution of the application can be created, by way of the Distribution plugin (which is automatically applied). A main distribution is created with the following content:

表45.1. 分布内容
Table 45.1. Distribution content

|Location	|Content|
|--
|(root dir)	|src/dist|
|lib	 |All runtime dependencies and main source set class files.|
|bin	 |Start scripts (generated by createStartScripts task).|

静态文件要添加到distribution可以简单的添加到src/dist下,更高级的定制可以通过主distribution的CopySpec配置来完成。

Static files to be added to the distribution can be simply added to src/dist. More advanced customization can be done by configuring the CopySpec exposed by the main distribution.

示例 45.4. 包括来自其他tasks的应用程序分布
Example 45.4. Include output from other tasks in the application distribution

build.gradle
```
task createDocs {
    def docs = file("$buildDir/docs")
    outputs.dir docs
    doLast {
        docs.mkdirs()
        new File(docs, "readme.txt").write("Read me!")
    }
}

distributions {
    main {
        contents {
            from(createDocs) {
                into "docs"
            }
        }
    }
}
```

通过指定的分配-应包括任务的输出文件（见第14.9.1,“声明一个任务的输入和输出”），Gradle知道任务在产生该文件的任务必须调用的分布可以被组装之前和会照顾这个给你.

By specifying that the distribution should include the task's output files (see Section 14.9.1, “Declaring a task's inputs and outputs”), Gradle knows that the task that produces the files must be invoked before the distribution can be assembled and will take care of this for you.

示例45.5.自动创建分布文件

Example 45.5. Automatically creating files for distribution

执行gradle distZip,输出:
Output of gradle distZip
> gradle distZip
```
:createDocs
:compileJava
:processResources UP-TO-DATE
:classes
:jar
:startScripts
:distZip

BUILD SUCCESSFUL

Total time: 1 secs
```

您可以运行gradle installDist来创建应用程序的构建/安装/项目名.您可以运行gradle distZip来创建包含分布的ZIP,用gradle distTar来创建一个TAR应用程序或运行gradle assemble来构建两者.

You can run gradle installDist to create an image of the application in build/install/projectName. You can run gradle distZip to create a ZIP containing the distribution, gradle distTar to create an application TAR or gradle assemble to build both.

45.1.2.自定义启动脚本生成

45.1.2. Customizing start script generation

application插件能生成可立即使用的UNIX(适用于在Linux，MacOSX等)和Windows启动脚本.该启动脚本启动一个JVM来指定默认的部分构建和运行时环境（如,JAVA_OPTS环境变量）.该默认脚本模板与启动Gradle的脚本类似,可作为Gradle分布式的一部分.

The application plugin can generate Unix (suitable for Linux, Mac OS X etc.) and Windows start scripts out of the box. The start scripts launch a JVM with the specified settings defined as part of the original build and runtime environment (e.g. JAVA_OPTS env var). The default script templates are based on the same scripts used to launch Gradle itself, that ship as part of a Gradle distribution.

该启动脚本是完全可定制的.更多细节和定制的例子请参阅CreateStartScripts文档.

The start scripts are completely customizable. Please refer to the documentation of CreateStartScripts for more details and customization examples.

## **45.2.任务**

45.2. Tasks

该Application插件添加了以下任务到项目.

The Application plugin adds the following tasks to the project.

表45.2.应用插件 - 任务

Table 44.2. Application plugin - tasks

|任务名称		|依赖				|类型 				|描述|
|--
|Task name		|Depends on		|	Type	|			Description|
|run		|		classes		|		JavaExec	|		Starts the application.|
|startScripts|	jar				|	CreateStartScripts|	Creates OS specific scripts to run the project as a JVM application.|
|installDist	|	jar,startScripts	|Sync			|	Installs the application into a specified directory.|
|distZip			|jar,startScripts	|Zip			|		Creates a full distribution ZIP archive including runtime libraries and OS specific scripts.|
|distTar		|	jar,startScripts	|Tar		|			Creates a full distribution TAR archive including runtime libraries and OS specific scripts.|


## **45.3.约定属性**

45.3. Convention properties

该application插件为项目增加了一些特性,你可以用它来配置它的行为.请参见API文档中项目类.

The application plugin adds some properties to the project, which you can use to configure its behaviour. See the Project class in the API documentation.

百度搜索[无线学院](http://wirelesscollege.cn)